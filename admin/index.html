<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Admin - redirigiendo...</title>
</head>

<body>
    <p>Verificando usuario y redirigiendo...</p>

    <script type="module">
        import { firebaseConfig } from '../assets/js/firebase-config.js';
        import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";

        const app = getApps().length ? getApps()[0] : initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const ROLE_ROUTES = {
            vendedor: 'vendedor.html',
            motorizado: 'motorizado.html',
            administrador: 'administrador.html'
        };

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = '/index.html';
                return;
            }
            try {
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    const role = userDoc.data().role || 'vendedor';
                    window.location.href = ROLE_ROUTES[role] || ROLE_ROUTES['vendedor'];
                } else {
                    window.location.href = ROLE_ROUTES['vendedor'];
                }
            } catch (err) {
                console.error(err);
                window.location.href = '/index.html';
            }
        });
    </script>
</body>

</html>